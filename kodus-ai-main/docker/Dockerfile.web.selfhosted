# Self-hosted deployment for kodus-web (Next.js)
FROM docker.io/library/node:22.22.0-slim AS selfhosted

RUN apt-get update && apt-get install -y curl

WORKDIR /usr/src/app

ENV WEB_NODE_ENV=self-hosted
ENV NODE_ENV=production

EXPOSE 3000

# Copy all source code
COPY . .

# Install, build and start at runtime to ensure env vars are available during build
CMD ["sh", "-c", "yarn install --production=false && yarn build && yarn start"]
